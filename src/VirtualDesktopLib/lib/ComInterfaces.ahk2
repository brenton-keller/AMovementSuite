static _init() {
  OS_Version := FileGetVersion(A_WinDir "\System32\twinui.pcshell.dll")
  splitByDot := StrSplit(OS_Version, ".")
  buildNumber := splitByDot[3] + 0
  revisionNumber := splitByDot[4] + 0
  if (buildNumber < 20348) {
    IID_IVirtualDesktopManagerInternal_str := "{f31574d6-b682-4cdc-bd56-1827860abec6}"
    IID_IVirtualDesktop_str := "{FF72FFDD-BE7E-43FC-9C03-AD81681E88E4}"
    this.IID_IVirtualDesktopNotification_n1 := 4671150449476842316
    this.IID_IVirtualDesktopNotification_n2 := 6512317045282349502
    idx_MoveViewToDesktop := 4
    idx_GetCurrentDesktop := 6
    idx_GetDesktops := 7
    idx_CreateDesktop := 10
    idx_RemoveDesktop := 11
    this._dll_MoveViewToDesktop := this._dll_MoveViewToDesktop_normal
    this._dll_GetCurrentDesktop := this._dll_GetCurrentDesktop_normal
    this._dll_GetDesktops := this._dll_GetDesktops_normal
    this._dll_CreateDesktop := this._dll_CreateDesktop_normal
    this._dll_RemoveDesktop := this._dll_RemoveDesktop_normal
    this.idx_GetId := 4
    this.idx_VirtualDesktopNameChanged := -1
    this.idx_SetDesktopName := -1
    this.idx_GetName := -1
    this.idx_VirtualDesktopWallpaperChanged := -1
    this.idx_SetDesktopWallpaper := -1
    this.idx_GetWallpaper := -1
    this.idx_VirtualDesktopCreated := 3
    this.idx_VirtualDesktopDestroyBegin := 4
    this.idx_VirtualDesktopDestroyFailed := 5
    this.idx_VirtualDesktopDestroyed := 6
    this.idx_ViewVirtualDesktopChanged := 7
    this.idx_CurrentVirtualDesktopChanged := 8
    this._dll_VirtualDesktopCreated := VD._dll_VirtualDesktopCreated_normal
    this._dll_VirtualDesktopDestroyBegin := VD._dll_VirtualDesktopDestroyBegin_normal
    this._dll_VirtualDesktopDestroyFailed := VD._dll_VirtualDesktopDestroyFailed_normal
    this._dll_VirtualDesktopDestroyed := VD._dll_VirtualDesktopDestroyed_normal
    this._dll_ViewVirtualDesktopChanged := VD._dll_ViewVirtualDesktopChanged_normal
    this._dll_CurrentVirtualDesktopChanged := VD._dll_CurrentVirtualDesktopChanged_normal
    this.IVirtualDesktopNotification_methods_count := 9
  } else if (buildNumber < 22000) {
    IID_IVirtualDesktopManagerInternal_str := "{094afe11-44f2-4ba0-976f-29a97e263ee0}"
    IID_IVirtualDesktop_str := "{62fdf88b-11ca-4afb-8bd8-2296dfae49e2}"
    this.IID_IVirtualDesktopNotification_n1 := 4844864968146173457
    this.IID_IVirtualDesktopNotification_n2 := 6287598790844042150
    idx_MoveViewToDesktop := 4
    idx_GetCurrentDesktop := 6
    idx_GetDesktops := 7
    idx_CreateDesktop := 10
    idx_RemoveDesktop := 11
    this._dll_MoveViewToDesktop := this._dll_MoveViewToDesktop_normal
    this._dll_GetCurrentDesktop := this._dll_GetCurrentDesktop_HMONITOR
    this._dll_GetDesktops := this._dll_GetDesktops_HMONITOR
    this._dll_CreateDesktop := this._dll_CreateDesktop_HMONITOR
    this._dll_RemoveDesktop := this._dll_RemoveDesktop_normal
    this.idx_GetId := 4
    this.idx_VirtualDesktopNameChanged := 8
    this._dll_VirtualDesktopNameChanged := VD._dll_VirtualDesktopNameChanged_normal
    this.idx_SetDesktopName := 14
    this.idx_GetName := 6
    this.idx_VirtualDesktopWallpaperChanged := -1
    this.idx_SetDesktopWallpaper := -1
    this.idx_GetWallpaper := -1
    this.idx_VirtualDesktopCreated := 3
    this.idx_VirtualDesktopDestroyBegin := 4
    this.idx_VirtualDesktopDestroyFailed := 5
    this.idx_VirtualDesktopDestroyed := 6
    this.idx_ViewVirtualDesktopChanged := 9
    this.idx_CurrentVirtualDesktopChanged := 10
    this._dll_VirtualDesktopCreated := VD._dll_VirtualDesktopCreated_normal
    this._dll_VirtualDesktopDestroyBegin := VD._dll_VirtualDesktopDestroyBegin_normal
    this._dll_VirtualDesktopDestroyFailed := VD._dll_VirtualDesktopDestroyFailed_normal
    this._dll_VirtualDesktopDestroyed := VD._dll_VirtualDesktopDestroyed_normal
    this._dll_ViewVirtualDesktopChanged := VD._dll_ViewVirtualDesktopChanged_normal
    this._dll_CurrentVirtualDesktopChanged := VD._dll_CurrentVirtualDesktopChanged_normal
    this.IVirtualDesktopNotification_methods_count := 11
  } else if (buildNumber < 22483) {
    IID_IVirtualDesktopManagerInternal_str := "{b2f925b9-5a0f-4d2e-9f4d-2b1507593c10}"
    IID_IVirtualDesktop_str := "{536d3495-b208-4cc9-ae26-de8111275bf8}"
    this.IID_IVirtualDesktopNotification_n1 := 5481970284372180562
    this.IID_IVirtualDesktopNotification_n2 := -1679294552252794956
    idx_MoveViewToDesktop := 4
    idx_GetCurrentDesktop := 6
    idx_GetDesktops := 7
    idx_CreateDesktop := 10
    idx_RemoveDesktop := 12
    this._dll_MoveViewToDesktop := this._dll_MoveViewToDesktop_normal
    this._dll_GetCurrentDesktop := this._dll_GetCurrentDesktop_HMONITOR
    this._dll_GetDesktops := this._dll_GetDesktops_HMONITOR
    this._dll_CreateDesktop := this._dll_CreateDesktop_HMONITOR
    this._dll_RemoveDesktop := this._dll_RemoveDesktop_normal
    this.idx_GetId := 4
    this.idx_VirtualDesktopNameChanged := 9
    this._dll_VirtualDesktopNameChanged := VD._dll_VirtualDesktopNameChanged_normal
    this.idx_SetDesktopName := 15
    this.idx_GetName := 6
    this.idx_VirtualDesktopWallpaperChanged := 12
    this._dll_VirtualDesktopWallpaperChanged := VD._dll_VirtualDesktopWallpaperChanged_normal
    this.idx_SetDesktopWallpaper := 16
    this.idx_GetWallpaper := 7
    this.idx_VirtualDesktopCreated := 3
    this.idx_VirtualDesktopDestroyBegin := 4
    this.idx_VirtualDesktopDestroyFailed := 5
    this.idx_VirtualDesktopDestroyed := 6
    this.idx_ViewVirtualDesktopChanged := 10
    this.idx_CurrentVirtualDesktopChanged := 11
    this._dll_VirtualDesktopCreated := VD._dll_VirtualDesktopCreated_IObjectArray
    this._dll_VirtualDesktopDestroyBegin := VD._dll_VirtualDesktopDestroyBegin_IObjectArray
    this._dll_VirtualDesktopDestroyFailed := VD._dll_VirtualDesktopDestroyFailed_IObjectArray
    this._dll_VirtualDesktopDestroyed := VD._dll_VirtualDesktopDestroyed_IObjectArray
    this._dll_ViewVirtualDesktopChanged := VD._dll_ViewVirtualDesktopChanged_normal
    this._dll_CurrentVirtualDesktopChanged := VD._dll_CurrentVirtualDesktopChanged_IObjectArray
    this.IVirtualDesktopNotification_methods_count := 13
  } else if (buildNumber <= 22621 && revisionNumber < 2215) {
    IID_IVirtualDesktopManagerInternal_str := "{b2f925b9-5a0f-4d2e-9f4d-2b1507593c10}"
    IID_IVirtualDesktop_str := "{536d3495-b208-4cc9-ae26-de8111275bf8}"
    this.IID_IVirtualDesktopNotification_n1 := 5481970284372180562
    this.IID_IVirtualDesktopNotification_n2 := -1679294552252794956
    idx_MoveViewToDesktop := 4
    idx_GetCurrentDesktop := 6
    idx_GetDesktops := 8
    idx_CreateDesktop := 11
    idx_RemoveDesktop := 13
    this._dll_MoveViewToDesktop := this._dll_MoveViewToDesktop_normal
    this._dll_GetCurrentDesktop := this._dll_GetCurrentDesktop_HMONITOR
    this._dll_GetDesktops := this._dll_GetDesktops_HMONITOR
    this._dll_CreateDesktop := this._dll_CreateDesktop_HMONITOR
    this._dll_RemoveDesktop := this._dll_RemoveDesktop_normal
    this.idx_GetId := 4
    this.idx_VirtualDesktopNameChanged := 9
    this._dll_VirtualDesktopNameChanged := VD._dll_VirtualDesktopNameChanged_normal
    this.idx_SetDesktopName := 16
    this.idx_GetName := 6
    this.idx_VirtualDesktopWallpaperChanged := 12
    this._dll_VirtualDesktopWallpaperChanged := VD._dll_VirtualDesktopWallpaperChanged_normal
    this.idx_SetDesktopWallpaper := 17
    this.idx_GetWallpaper := 7
    this.idx_VirtualDesktopCreated := 3
    this.idx_VirtualDesktopDestroyBegin := 4
    this.idx_VirtualDesktopDestroyFailed := 5
    this.idx_VirtualDesktopDestroyed := 6
    this.idx_ViewVirtualDesktopChanged := 10
    this.idx_CurrentVirtualDesktopChanged := 11
    this._dll_VirtualDesktopCreated := VD._dll_VirtualDesktopCreated_IObjectArray
    this._dll_VirtualDesktopDestroyBegin := VD._dll_VirtualDesktopDestroyBegin_IObjectArray
    this._dll_VirtualDesktopDestroyFailed := VD._dll_VirtualDesktopDestroyFailed_IObjectArray
    this._dll_VirtualDesktopDestroyed := VD._dll_VirtualDesktopDestroyed_IObjectArray
    this._dll_ViewVirtualDesktopChanged := VD._dll_ViewVirtualDesktopChanged_normal
    this._dll_CurrentVirtualDesktopChanged := VD._dll_CurrentVirtualDesktopChanged_IObjectArray
    this.IVirtualDesktopNotification_methods_count := 13
  } else if (buildNumber <= 22631 && revisionNumber < 3085) {
    IID_IVirtualDesktopManagerInternal_str := "{4970ba3d-fd4e-4647-bea3-d89076ef4b9c}"
    IID_IVirtualDesktop_str := "{3f07f4be-b107-441a-af0f-39d82529072c}"
    this.IID_IVirtualDesktopNotification_n1 := 5123538856297626140
    this.IID_IVirtualDesktopNotification_n2 := 8491238173783613346
    idx_MoveViewToDesktop := 4
    idx_GetCurrentDesktop := 6
    idx_GetDesktops := 7
    idx_CreateDesktop := 10
    idx_RemoveDesktop := 12
    this._dll_MoveViewToDesktop := this._dll_MoveViewToDesktop_normal
    this._dll_GetCurrentDesktop := this._dll_GetCurrentDesktop_normal
    this._dll_GetDesktops := this._dll_GetDesktops_normal
    this._dll_CreateDesktop := this._dll_CreateDesktop_normal
    this._dll_RemoveDesktop := this._dll_RemoveDesktop_normal
    this.idx_GetId := 4
    this.idx_VirtualDesktopNameChanged := 8
    this._dll_VirtualDesktopNameChanged := VD._dll_VirtualDesktopNameChanged_normal
    this.idx_SetDesktopName := 15
    this.idx_GetName := 5
    this.idx_VirtualDesktopWallpaperChanged := 11
    this._dll_VirtualDesktopWallpaperChanged := VD._dll_VirtualDesktopWallpaperChanged_normal
    this.idx_SetDesktopWallpaper := 16
    this.idx_GetWallpaper := 6
    this.idx_VirtualDesktopCreated := 3
    this.idx_VirtualDesktopDestroyBegin := 4
    this.idx_VirtualDesktopDestroyFailed := 5
    this.idx_VirtualDesktopDestroyed := 6
    this.idx_ViewVirtualDesktopChanged := 9
    this.idx_CurrentVirtualDesktopChanged := 10
    this._dll_VirtualDesktopCreated := VD._dll_VirtualDesktopCreated_normal
    this._dll_VirtualDesktopDestroyBegin := VD._dll_VirtualDesktopDestroyBegin_normal
    this._dll_VirtualDesktopDestroyFailed := VD._dll_VirtualDesktopDestroyFailed_normal
    this._dll_VirtualDesktopDestroyed := VD._dll_VirtualDesktopDestroyed_normal
    this._dll_ViewVirtualDesktopChanged := VD._dll_ViewVirtualDesktopChanged_normal
    this._dll_CurrentVirtualDesktopChanged := VD._dll_CurrentVirtualDesktopChanged_normal
    this.IVirtualDesktopNotification_methods_count := 14
  } else if (buildNumber < 26100) {
    IID_IVirtualDesktopManagerInternal_str := "{53f5ca0b-158f-4124-900c-057158060b27}"
    IID_IVirtualDesktop_str := "{3f07f4be-b107-441a-af0f-39d82529072c}"
    this.IID_IVirtualDesktopNotification_n1 := 5308375338100058445
    this.IID_IVirtualDesktopNotification_n2 := -2401892766147978065
    idx_MoveViewToDesktop := 4
    idx_GetCurrentDesktop := 6
    idx_GetDesktops := 7
    idx_SwitchDesktop := 9
    idx_CreateDesktop := 10
    idx_RemoveDesktop := 12
    this.idx_SwitchDesktopWithAnimation := 21
    this._dll_MoveViewToDesktop := this._dll_MoveViewToDesktop_normal
    this._dll_GetCurrentDesktop := this._dll_GetCurrentDesktop_normal
    this._dll_GetDesktops := this._dll_GetDesktops_normal
    ; this._dll_SwitchDesktop := this._dll_SwitchDesktop_normal
    this._dll_CreateDesktop := this._dll_CreateDesktop_normal
    this._dll_RemoveDesktop := this._dll_RemoveDesktop_normal
    this.idx_GetId := 4
    this.idx_VirtualDesktopNameChanged := 8
    this._dll_VirtualDesktopNameChanged := VD._dll_VirtualDesktopNameChanged_normal
    this.idx_SetDesktopName := 15
    this.idx_GetName := 5
    this.idx_VirtualDesktopWallpaperChanged := 11
    this._dll_VirtualDesktopWallpaperChanged := VD._dll_VirtualDesktopWallpaperChanged_normal
    this.idx_SetDesktopWallpaper := 16
    this.idx_GetWallpaper := 6
    this.idx_VirtualDesktopCreated := 3
    this.idx_VirtualDesktopDestroyBegin := 4
    this.idx_VirtualDesktopDestroyFailed := 5
    this.idx_VirtualDesktopDestroyed := 6
    this.idx_ViewVirtualDesktopChanged := 9
    this.idx_CurrentVirtualDesktopChanged := 10
    this._dll_VirtualDesktopCreated := VD._dll_VirtualDesktopCreated_normal
    this._dll_VirtualDesktopDestroyBegin := VD._dll_VirtualDesktopDestroyBegin_normal
    this._dll_VirtualDesktopDestroyFailed := VD._dll_VirtualDesktopDestroyFailed_normal
    this._dll_VirtualDesktopDestroyed := VD._dll_VirtualDesktopDestroyed_normal
    this._dll_ViewVirtualDesktopChanged := VD._dll_ViewVirtualDesktopChanged_normal
    this._dll_CurrentVirtualDesktopChanged := VD._dll_CurrentVirtualDesktopChanged_normal
    this.IVirtualDesktopNotification_methods_count := 14
  } else {
    IID_IVirtualDesktopManagerInternal_str := "{4970ba3d-fd4e-4647-bea3-d89076ef4b9c}"
    IID_IVirtualDesktop_str := "{3f07f4be-b107-441a-af0f-39d82529072c}"
    this.IID_IVirtualDesktopNotification_n1 := 5308375338100058445
    this.IID_IVirtualDesktopNotification_n2 := -2401892766147978065
    idx_MoveViewToDesktop := 4
    idx_GetCurrentDesktop := 6
    idx_GetDesktops := 7
    idx_CreateDesktop := 10
    idx_RemoveDesktop := 12
    this._dll_MoveViewToDesktop := this._dll_MoveViewToDesktop_normal
    this._dll_GetCurrentDesktop := this._dll_GetCurrentDesktop_normal
    this._dll_GetDesktops := this._dll_GetDesktops_normal
    this._dll_CreateDesktop := this._dll_CreateDesktop_normal
    this._dll_RemoveDesktop := this._dll_RemoveDesktop_normal
    this.idx_GetId := 4
    this.idx_VirtualDesktopNameChanged := 8
    this._dll_VirtualDesktopNameChanged := VD._dll_VirtualDesktopNameChanged_normal
    this.idx_SetDesktopName := 15
    this.idx_GetName := 5
    this.idx_VirtualDesktopWallpaperChanged := 11
    this._dll_VirtualDesktopWallpaperChanged := VD._dll_VirtualDesktopWallpaperChanged_normal
    this.idx_SetDesktopWallpaper := 16
    this.idx_GetWallpaper := 6
    this.idx_VirtualDesktopCreated := 3
    this.idx_VirtualDesktopDestroyBegin := 4
    this.idx_VirtualDesktopDestroyFailed := 5
    this.idx_VirtualDesktopDestroyed := 6
    this.idx_ViewVirtualDesktopChanged := 9
    this.idx_CurrentVirtualDesktopChanged := 10
    this._dll_VirtualDesktopCreated := VD._dll_VirtualDesktopCreated_normal
    this._dll_VirtualDesktopDestroyBegin := VD._dll_VirtualDesktopDestroyBegin_normal
    this._dll_VirtualDesktopDestroyFailed := VD._dll_VirtualDesktopDestroyFailed_normal
    this._dll_VirtualDesktopDestroyed := VD._dll_VirtualDesktopDestroyed_normal
    this._dll_ViewVirtualDesktopChanged := VD._dll_ViewVirtualDesktopChanged_normal
    this._dll_CurrentVirtualDesktopChanged := VD._dll_CurrentVirtualDesktopChanged_normal
    this.IVirtualDesktopNotification_methods_count := 14
  }
  this.IVirtualDesktopManager := ComObject("{aa509086-5ca9-4c25-8f95-589d3c07b48a}", "{a5cd92ff-29be-454c-8d04-d82879fb3f1b}")
  this.ptr_MoveWindowToDesktop := this._vtable(this.IVirtualDesktopManager.Ptr, 5)
  this.CImmersiveShell_IServiceProvider := ComObject("{c2f03a33-21f5-47fa-b4bb-156362a2f239}", "{6d5140c1-7436-11ce-8034-00aa006009fa}")
  this.IVirtualDesktopManagerInternal := ComObjQuery(this.CImmersiveShell_IServiceProvider.Ptr, "{c5e0cdca-7b6e-41b2-9fc4-d93975cc467b}", IID_IVirtualDesktopManagerInternal_str)
  this.IVirtualDesktopPinnedApps := ComObjQuery(this.CImmersiveShell_IServiceProvider.Ptr, "{b5a399e7-1c87-46b8-88e9-fc5747b171bd}", "{4ce81583-1e4c-4632-a621-07a53543148f}")
  this.IApplicationViewCollection := ComObjQuery(this.CImmersiveShell_IServiceProvider.Ptr, "{1841c6d7-4f9d-42c0-af41-8747538f10e5}", "{1841c6d7-4f9d-42c0-af41-8747538f10e5}")
  this.ptr_MoveViewToDesktop := this._vtable(this.IVirtualDesktopManagerInternal.Ptr, idx_MoveViewToDesktop)
  this.ptr_GetCurrentDesktop := this._vtable(this.IVirtualDesktopManagerInternal.Ptr, idx_GetCurrentDesktop)
  this.ptr_GetDesktops := this._vtable(this.IVirtualDesktopManagerInternal.Ptr, idx_GetDesktops)
  this.ptr_CreateDesktop := this._vtable(this.IVirtualDesktopManagerInternal.Ptr, idx_CreateDesktop)
  this.ptr_RemoveDesktop := this._vtable(this.IVirtualDesktopManagerInternal.Ptr, idx_RemoveDesktop)
  if (this.idx_SetDesktopName > -1) {
    this.ptr_SetDesktopName := this._vtable(this.IVirtualDesktopManagerInternal.Ptr, this.idx_SetDesktopName)
  }
  if (this.idx_SetDesktopWallpaper > -1) {
    this.ptr_SetDesktopWallpaper := this._vtable(this.IVirtualDesktopManagerInternal.Ptr, this.idx_SetDesktopWallpaper)
  }
  this.ptr_IsViewPinned := this._vtable(this.IVirtualDesktopPinnedApps.Ptr, 6)
  this.ptr_PinView := this._vtable(this.IVirtualDesktopPinnedApps.Ptr, 7)
  this.ptr_UnpinView := this._vtable(this.IVirtualDesktopPinnedApps.Ptr, 8)
  this.ptr_GetViewForHwnd := this._vtable(this.IApplicationViewCollection.Ptr, 6)
  this.IID_IVirtualDesktop_ptr := DllCall("GlobalAlloc", "UInt", 0x00, "Uint", 16, "Ptr")
  DllCall("ole32\CLSIDFromString", "Str", IID_IVirtualDesktop_str, "Ptr", this.IID_IVirtualDesktop_ptr)
  this.savedLocalizedWord_Desktop := false
}

class IObjectArray_Wrapper {
  __New(IObjectArray, IID_Interface_ptr) {
    this.IObjectArray := IObjectArray
    this.IID_Interface_ptr := IID_Interface_ptr
    this.ptr_GetAt := VD._vtable(IObjectArray, 4)
  }
  __Delete() {
    ptr_Release := VD._vtable(this.IObjectArray, 2)
    DllCall(ptr_Release, "Ptr", this.IObjectArray)
  }
  GetAt(oneBasedIndex) {
    DllCall(this.ptr_GetAt, "Ptr", this.IObjectArray, "UInt", oneBasedIndex - 1, "Ptr", this.IID_Interface_ptr, "Ptr*", &IInterface := 0)
    return IInterface
  }
  GetCount() {
    ptr_GetCount := VD._vtable(this.IObjectArray, 3)
    Count := 0
    DllCall(ptr_GetCount, "Ptr", this.IObjectArray, "UInt*", &Count := 0)
    return Count
  }
}
